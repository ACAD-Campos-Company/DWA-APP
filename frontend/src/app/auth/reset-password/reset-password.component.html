<div
  class="container-reset-password h-100 d-flex flex-column align-items-center"
>
  <div class="header-container d-grid align-items-center w-100">
    <img
      [routerLink]="currentStep === 1 ? '/login' : null"
      class="header-button"
      src="assets/images/back-button.png"
      alt="Voltar"
      (click)="handleBackButtonClick()"
      aria-label="Voltar"
    />
    <h1 class="text-center">Recuperar senha</h1>
    <img
      *ngIf="currentStep !== 1"
      routerLink="/login"
      class="header-button"
      src="assets/images/home-button.png"
      alt="Home"
      aria-label="Home"
    />
  </div>

  <div class="w-100 h-100 d-flex flex-column align-items-center">
    <ng-container [ngTemplateOutlet]="getCurrentStepTemplate()"></ng-container>
  </div>

  <p class="error-message mt-5" *ngIf="errorMessage">{{ errorMessage }}</p>

  <app-loading></app-loading>

  <ng-template #firstStepTemplate>
    <img class="logo" src="assets/images/logo/dwa-logo.svg" alt="Logo" />
    <form
      [formGroup]="firstStepForm"
      class="w-100 h-100 d-flex flex-column justify-content-between"
    >
      <app-input
        label="CPF"
        mask="000.000.000-00"
        [control]="$any(firstStepForm).controls['document']"
      ></app-input>
      <app-button text="Próximo" (clicked)="onSubmit()"></app-button>
    </form>
  </ng-template>

  <ng-template #secondStepTemplate>
    <h3 class="mb-4 text-center">
      Para recuperar sua senha basta confirmar seu número de telefone.
    </h3>
    <div class="phone-container">
      <span class="phone-confirm">{{ userPhone }}</span>
    </div>
    <h4 class="mb-4">Não reconhece esse número?</h4>
    <form
      [formGroup]="secondStepForm"
      class="w-100 h-100 d-flex flex-column justify-content-between"
    >
      <app-input
        label="Confirme seu telefone"
        mask="(00) 00000-0000"
        [control]="$any(secondStepForm).controls['telephone']"
      ></app-input>
      <app-button text="Próximo" (clicked)="onSubmit()"></app-button>
    </form>
  </ng-template>

  <ng-template #thirdStepTemplate>
    <h3 class="mb-5">Digite e confirme sua nova senha</h3>
    <form
      [formGroup]="thirdStepForm"
      class="w-100 h-100 d-flex flex-column justify-content-between"
    >
      <app-input
        label="Digite sua nova senha"
        type="password"
        [control]="$any(thirdStepForm).controls['password']"
      ></app-input>
      <app-input
        label="Confirme nova senha"
        type="password"
        [control]="$any(thirdStepForm).controls['password_confirmation']"
      ></app-input>
      <p
        *ngIf="
          thirdStepForm.invalid && thirdStepForm.touched && thirdStepForm.errors
        "
        class="error-message"
      >
        {{ thirdStepForm.errors | onlyOneError }}
      </p>
      <app-button text="Salvar" (clicked)="onSubmit()"></app-button>
    </form>
  </ng-template>
</div>
